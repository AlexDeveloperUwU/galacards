<!DOCTYPE html>
<html lang="es">
<%- include('components/head') %>

<body class="min-h-screen p-6 md:p-8 flex flex-col items-center justify-center bg-[#221824]">
  <h1 class="text-5xl md:text-6xl text-white font-bold mb-10 animate-glow tracking-wider">¿Quién soy?</h1>

  <div class="w-full max-w-7xl mx-auto rounded-2xl shadow-2xl overflow-hidden backdrop-blur-sm">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 md:gap-6 p-6 md:p-8 bg-purple-bg">

      <div class="w-full flex flex-col items-center">
        <span id="cardName1" class="text-white text-lg font-bold mb-2 animate-glow">Foto random 1</span>
        <div class="w-full h-0 pb-[133.33%] relative">
          <div class="absolute inset-0 rounded-2xl bg-purple-card border-2 border-purple-light shadow-card hover:shadow-glow transition-all duration-300 flex items-center justify-center transform hover:scale-[1.02] cursor-pointer">
            <span class="text-7xl font-bold text-white opacity-90">1</span>
          </div>
        </div>
      </div>

      <div class="w-full flex flex-col items-center">
        <span id="cardName2" class="text-white text-lg font-bold mb-2 animate-glow">Miau?</span>
        <div class="w-full h-0 pb-[133.33%] relative">
          <div class="absolute inset-0 rounded-2xl bg-purple-card border-2 border-purple-light shadow-card hover:shadow-glow transition-all duration-300 flex items-center justify-center transform hover:scale-[1.02] cursor-pointer">
            <span class="text-7xl font-bold text-white opacity-90">2</span>
          </div>
        </div>
      </div>

      <div class="w-full flex flex-col items-center">
        <span id="cardName3" class="text-white text-lg font-bold mb-2 animate-glow">Otro vtuber más</span>
        <div class="w-full h-0 pb-[133.33%] relative">
          <div class="absolute inset-0 rounded-2xl bg-purple-card border-2 border-purple-light shadow-card hover:shadow-glow transition-all duration-300 flex items-center justify-center transform hover:scale-[1.02] cursor-pointer">
            <span class="text-7xl font-bold text-white opacity-90">3</span>
          </div>
        </div>
      </div>

      <div class="w-full flex flex-col items-center">
        <span id="cardName4" class="text-white text-lg font-bold mb-2 animate-glow">Good luck guessing!</span>
        <div class="w-full h-0 pb-[133.33%] relative">
          <div class="absolute inset-0 rounded-2xl bg-purple-card border-2 border-purple-light shadow-card hover:shadow-glow transition-all duration-300 flex items-center justify-center transform hover:scale-[1.02] cursor-pointer">
            <span class="text-7xl font-bold text-white opacity-90">4</span>
          </div>
        </div>
      </div>

      <div class="w-full flex flex-col items-center">
        <span class="text-transparent text-lg font-bold mb-2">&nbsp;</span>
        <div class="w-full h-0 pb-[133.33%] relative">
          <div class="absolute inset-0 rounded-2xl bg-purple-medium border-2 border-purple-light shadow-card flex flex-col items-center justify-center p-6">
            <h3 class="text-2xl text-purple-light font-bold mb-6 border-b-2 border-purple-light pb-2 w-full text-center">Stats</h3>
            <div class="text-center space-y-4 w-full">
              <div class="bg-purple-bg bg-opacity-50 rounded-lg p-3">
                <p class="text-white">Restante: <span class="font-bold text-purple-light" id="avaliableCards">0</span></p>
              </div>
              <div class="bg-purple-bg bg-opacity-50 rounded-lg p-3">
                <p class="text-white">Ronda: <span class="font-bold text-purple-light" id="roundNumber">0</span></p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="w-full flex flex-col items-center">
        <div class="w-full h-0 pb-[133.33%] relative">
          <iframe class="absolute inset-0 w-full h-full rounded-2xl border-2 border-purple-light shadow-card hover:shadow-glow transition-all duration-300 transform hover:scale-[1.02] cursor-pointer" style="background-color: transparent;" src="" id="player1iframe"></iframe>
        </div>
        <span id="playerName1" class="text-white text-lg font-bold animate-glow mt-2">Nya</span>
      </div>

      <div class="w-full flex flex-col items-center">
        <div class="w-full h-0 pb-[133.33%] relative">
          <iframe class="absolute inset-0 w-full h-full rounded-2xl border-2 border-purple-light shadow-card hover:shadow-glow transition-all duration-300 transform hover:scale-[1.02] cursor-pointer" style="background-color: transparent;" src="" id="player2iframe"></iframe>
        </div>
        <span id="playerName2" class="text-white text-lg font-bold animate-glow mt-2">Tramposo/a</span>
      </div>

      <div class="w-full flex flex-col items-center">
        <div class="w-full h-0 pb-[133.33%] relative">
          <iframe class="absolute inset-0 w-full h-full rounded-2xl border-2 border-purple-light shadow-card hover:shadow-glow transition-all duration-300 transform hover:scale-[1.02] cursor-pointer" style="background-color: transparent;" src="" id="player3iframe"></iframe>
        </div>
        <span id="playerName3" class="text-white text-lg font-bold animate-glow mt-2">Quién vive en la</span>
      </div>

      <div class="w-full flex flex-col items-center">
        <div class="w-full h-0 pb-[133.33%] relative">
          <iframe class="absolute inset-0 w-full h-full rounded-2xl border-2 border-purple-light shadow-card hover:shadow-glow transition-all duration-300 transform hover:scale-[1.02] cursor-pointer" style="background-color: transparent;" src="" id="player4iframe"></iframe>
        </div>
        <span id="playerName4" class="text-white text-lg font-bold animate-glow mt-2">piña bajo el mar?</span>
      </div>

      <div class="w-full flex flex-col items-center">
        <div class="w-full h-0 pb-[133.33%] relative">
          <div class="absolute inset-0 rounded-2xl bg-purple-medium border-2 border-purple-light shadow-card flex flex-col items-center justify-center p-6">
            <h3 class="text-2xl text-purple-light font-bold mb-6 border-b-2 border-purple-light pb-2 w-full text-center">Controles</h3>
            <div class="space-y-3 w-full">
              <button class="w-full py-3 bg-purple-light text-purple-dark text-base font-bold rounded-lg hover:bg-purple-hover transition-colors duration-300 shadow-md transform hover:translate-y-[-2px]" id="changingGameButton">
                ¡Girar!
              </button>
              <button id="generateLinks" class="w-full py-3 bg-purple-light text-purple-dark text-base font-bold rounded-lg hover:bg-purple-hover transition-colors duration-300 shadow-md transform hover:translate-y-[-2px]">
                Generar links
              </button>
            </div>
          </div>
        </div>
        <span class="text-transparent text-lg font-bold mt-2">&nbsp;</span>
      </div>
    </div>
  </div>

  <script>
    //! Socket.io client
    const socket = io(window.location.host, {
      query: {
        id: 'galawaController'
      }
    });

    socket.on('connect', () => {
      console.log('Conectado al servidor');
    });

    socket.on('disconnect', () => {
      console.log('Desconectado del servidor');
    });

    socket.on("initialData", (players) => {

    })

    socket.on('generatedPlayerData', (players) => {
      const contentHtml = players.map(player => `
        <div class="bg-purple-bg bg-opacity-94 rounded-lg p-3">
          <p class="text-white">Nombre: <span class="font-bold text-purple-light">${player.name}</span></p>
          <button class="mt-2 w-full py-2 bg-purple-light text-purple-dark text-sm font-bold rounded-lg hover:bg-purple-hover transition-colors duration-300 shadow-md copy-link" data-game-url="https://example.com/game" data-vdo-url="${player.vdoUrl}">
            Copiar mensaje
          </button>
        </div>
      `).join('');

      Swal.fire({
        title: 'Datos de los participantes',
        html: contentHtml,
        customClass: {
          popup: 'bg-[#8b458b] rounded-2xl p-6 shadow-2xl',
          title: 'text-3xl text-white font-bold mb-4 text-center',
          htmlContainer: 'space-y-4',
          confirmButton: 'mt-4 w-[100%] mx-auto py-2 bg-purple-light text-purple-dark text-base font-bold rounded-lg hover:bg-purple-hover transition-colors duration-300 shadow-md'
        },
        showConfirmButton: true,
        confirmButtonText: 'Cerrar',
        didOpen: () => {
          document.querySelectorAll('.copy-link').forEach(button => {
            button.addEventListener('click', () => {
              const gameUrl = button.getAttribute('data-game-url');
              const vdoUrl = button.getAttribute('data-vdo-url');
              const message = `Aquí tienes los enlaces necesarios para jugar:\nJuego: ${gameUrl}\nAvatar: ${vdoUrl}`;
              navigator.clipboard.writeText(message).then(() => {
                alert('Enlace copiado al portapapeles');
              });
            });
          });
        }
      });
    });

    const generateLinksButton = document.getElementById('generateLinks');
    generateLinksButton.addEventListener('click', () => {
      Swal.fire({
        title: '¿Estás segura?',
        text: "¡Esto hará que los enlaces anteriores dejen de funcionar y necesites enviar los nuevos!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Warevah, dale!',
        cancelButtonText: 'Ñeh, mejor no',
        customClass: {
          popup: 'bg-[#8b458b] rounded-2xl p-6 shadow-2xl',
          title: 'text-3xl text-white font-bold mb-4 text-center',
          htmlContainer: 'text-white text-base text-center',
          confirmButton: 'mt-4 w-[100%] mx-auto py-2 bg-purple-light text-purple-dark text-base font-bold rounded-lg hover:bg-purple-hover transition-colors duration-300 shadow-md',
          cancelButton: 'mt-4 w-[100%] mx-auto py-2 bg-gray-500 text-white text-base font-bold rounded-lg hover:bg-gray-600 transition-colors duration-300 shadow-md'
        }
      }).then((result) => {
        if (result.isConfirmed) {
          socket.emit('generatePlayerData');
        }
      });
    });
  </script>

  <%- include('components/scripts') %>
</body>

</html>